"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/tour/[id]";
exports.ids = ["pages/api/tour/[id]"];
exports.modules = {

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftour%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Ftour%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftour%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Ftour%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_tour_id_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/tour/[id].js */ \"(api-node)/./src/pages/api/tour/[id].js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_tour_id_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_tour_id_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/tour/[id]\",\n        pathname: \"/api/tour/[id]\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _src_pages_api_tour_id_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGdG91ciUyRiU1QmlkJTVEJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTJGcGFnZXMlMkZhcGklMkZ0b3VyJTJGJTVCaWQlNUQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDeUQ7QUFDekQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHNEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxzREFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3NyYy9wYWdlcy9hcGkvdG91ci9baWRdLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90b3VyL1tpZF1cIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS90b3VyL1tpZF1cIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiAnJyxcbiAgICAgICAgZmlsZW5hbWU6ICcnXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftour%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Ftour%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./src/pages/api/tour/[id].js":
/*!************************************!*\
  !*** ./src/pages/api/tour/[id].js ***!
  \************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _utils_dbConnect__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../utils/dbConnect */ \"(api-node)/./src/utils/dbConnect.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n// edit and delete tour by id\n// Required fields: user_id\n\n\nasync function handler(req, res) {\n    const { id } = req.query;\n    // Convert id to ObjectId\n    let tourObjectId;\n    try {\n        tourObjectId = new mongodb__WEBPACK_IMPORTED_MODULE_1__.ObjectId(id);\n    } catch (err) {\n        return res.status(400).json({\n            error: \"Invalid tour ID format\"\n        });\n    }\n    if (req.method === \"GET\") {\n        try {\n            const mongooseInstance = await (0,_utils_dbConnect__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n            const db = mongooseInstance.connection.db;\n            const tour = await db.collection(\"tours\").findOne({\n                _id: tourObjectId\n            });\n            if (!tour) {\n                return res.status(404).json({\n                    error: \"Tour not found\"\n                });\n            }\n            // If tour has artwork IDs, fetch the artwork details\n            if (tour.artworks && tour.artworks.length > 0) {\n                try {\n                    console.log(`[API] Fetching artwork details for tour ${id} with artworks:`, tour.artworks);\n                    // Check available collections\n                    const collections = await db.listCollections().toArray();\n                    const collectionNames = collections.map((c)=>c.name);\n                    console.log(`[API] Available collections:`, collectionNames);\n                    // Determine the correct collection name\n                    let artCollectionName = \"arts\";\n                    if (!collectionNames.includes(\"arts\")) {\n                        const artCollections = collectionNames.filter((name)=>name.toLowerCase().includes(\"art\") && name !== \"tours\");\n                        if (artCollections.length > 0) {\n                            artCollectionName = artCollections[0];\n                            console.log(`[API] Using \"${artCollectionName}\" collection instead of \"arts\"`);\n                        }\n                    }\n                    // Don't convert IDs - we know they're strings from our earlier check\n                    const artworkIds = tour.artworks;\n                    console.log(`[API] Using artwork IDs as strings:`, artworkIds);\n                    // Query directly with string IDs since that's how they're stored\n                    const artworks = await db.collection(artCollectionName).find({\n                        _id: {\n                            $in: artworkIds\n                        }\n                    }).toArray();\n                    console.log(`[API] Found ${artworks.length} artworks:`, artworks.map((art)=>({\n                            id: art._id,\n                            name: art.name\n                        })));\n                    // Add the artwork details to the tour\n                    tour.artwork_details = artworks;\n                    // If we didn't find any artwork details, log a warning\n                    if (artworks.length === 0) {\n                        console.warn(`[API] No artwork details found for the IDs:`, tour.artworks);\n                    } else if (artworks.length < tour.artworks.length) {\n                        console.warn(`[API] Found only ${artworks.length} artworks out of ${tour.artworks.length} requested`);\n                        // Log which artwork IDs were not found\n                        const foundIds = artworks.map((a)=>a._id.toString());\n                        const missingIds = tour.artworks.filter((id)=>!foundIds.includes(id.toString()));\n                        console.warn(`[API] Missing artwork IDs:`, missingIds);\n                    }\n                } catch (error) {\n                    console.warn(\"[API] Could not fetch artwork details:\", error.message);\n                    console.error(error);\n                    // Continue even if artwork details could not be fetched\n                    tour.artwork_details = [];\n                }\n            } else {\n                console.log(`[API] Tour ${id} has no artworks to fetch details for`);\n                tour.artwork_details = [];\n            }\n            return res.status(200).json({\n                tour\n            });\n        } catch (error) {\n            console.error(\"Error fetching tour:\", error);\n            return res.status(500).json({\n                error: error.message\n            });\n        }\n    } else if (req.method === \"PUT\") {\n        try {\n            const { tour_name, visibility, description, city, artworks, user_id } = req.body;\n            // Require user_id for authorization\n            if (!user_id) {\n                return res.status(400).json({\n                    error: \"Missing user_id in request body\"\n                });\n            }\n            const mongooseInstance = await (0,_utils_dbConnect__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n            const db = mongooseInstance.connection.db;\n            // First check if user is authorized to edit this tour\n            const tour = await db.collection(\"tours\").findOne({\n                _id: tourObjectId\n            });\n            if (!tour) {\n                return res.status(404).json({\n                    error: \"Tour not found\"\n                });\n            }\n            // Compare tour's user_id with provided user_id for authorization\n            if (tour.user_id.toString() !== user_id.toString()) {\n                return res.status(403).json({\n                    error: \"Unauthorized: This is not your tour\"\n                });\n            }\n            // Build update object with only provided fields\n            let update = {};\n            if (tour_name !== undefined) update.tour_name = tour_name;\n            if (visibility !== undefined) update.visibility = visibility;\n            if (description !== undefined) update.description = description;\n            if (city !== undefined) update.city = city;\n            if (artworks !== undefined) update.artworks = artworks;\n            // Add last_updated timestamp\n            update.last_updated = new Date();\n            const result = await db.collection(\"tours\").updateOne({\n                _id: tourObjectId\n            }, {\n                $set: update\n            });\n            if (result.modifiedCount === 0) {\n                return res.status(404).json({\n                    error: \"No changes made\"\n                });\n            }\n            return res.status(200).json({\n                message: \"Tour updated successfully\"\n            });\n        } catch (error) {\n            console.error(\"Error updating tour:\", error);\n            return res.status(500).json({\n                error: error.message\n            });\n        }\n    } else if (req.method === \"DELETE\") {\n        try {\n            const { user_id } = req.body;\n            if (!user_id) {\n                return res.status(400).json({\n                    error: \"Missing user_id in request body\"\n                });\n            }\n            const mongooseInstance = await (0,_utils_dbConnect__WEBPACK_IMPORTED_MODULE_0__[\"default\"])();\n            const db = mongooseInstance.connection.db;\n            // Check if tour exists and if user is authorized to delete\n            const tour = await db.collection(\"tours\").findOne({\n                _id: tourObjectId\n            });\n            if (!tour) {\n                return res.status(404).json({\n                    error: \"Tour not found\"\n                });\n            }\n            // Compare user_ids for authorization\n            if (tour.user_id.toString() !== user_id.toString()) {\n                return res.status(403).json({\n                    error: \"Unauthorized: This is not your tour\"\n                });\n            }\n            // Delete the tour\n            const result = await db.collection(\"tours\").deleteOne({\n                _id: tourObjectId\n            });\n            if (result.deletedCount === 0) {\n                return res.status(404).json({\n                    error: \"Tour couldn't be deleted\"\n                });\n            }\n            // Also delete any saved instances of this tour\n            try {\n                await db.collection(\"savedTours\").deleteMany({\n                    tour_id: tourObjectId\n                });\n            } catch (error) {\n                console.warn(\"Error cleaning up saved tours:\", error.message);\n            // Continue even if saved tours could not be deleted\n            }\n            return res.status(200).json({\n                message: \"Tour deleted successfully\"\n            });\n        } catch (error) {\n            console.error(\"Error deleting tour:\", error);\n            return res.status(500).json({\n                error: error.message\n            });\n        }\n    } else {\n        res.setHeader(\"Allow\", [\n            \"GET\",\n            \"PUT\",\n            \"DELETE\"\n        ]);\n        return res.status(405).json({\n            error: `Method ${req.method} Not Allowed`\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3NyYy9wYWdlcy9hcGkvdG91ci9baWRdLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDZCQUE2QjtBQUM3QiwyQkFBMkI7QUFDd0I7QUFDaEI7QUFFcEIsZUFBZUUsUUFBUUMsR0FBRyxFQUFFQyxHQUFHO0lBQzVDLE1BQU0sRUFBRUMsRUFBRSxFQUFFLEdBQUdGLElBQUlHLEtBQUs7SUFFeEIseUJBQXlCO0lBQ3pCLElBQUlDO0lBQ0osSUFBSTtRQUNGQSxlQUFlLElBQUlOLDZDQUFRQSxDQUFDSTtJQUM5QixFQUFFLE9BQU9HLEtBQUs7UUFDWixPQUFPSixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBeUI7SUFDaEU7SUFFQSxJQUFJUixJQUFJUyxNQUFNLEtBQUssT0FBTztRQUN4QixJQUFJO1lBQ0YsTUFBTUMsbUJBQW1CLE1BQU1iLDREQUFXQTtZQUMxQyxNQUFNYyxLQUFLRCxpQkFBaUJFLFVBQVUsQ0FBQ0QsRUFBRTtZQUV6QyxNQUFNRSxPQUFPLE1BQU1GLEdBQUdHLFVBQVUsQ0FBQyxTQUFTQyxPQUFPLENBQUM7Z0JBQUVDLEtBQUtaO1lBQWE7WUFFdEUsSUFBSSxDQUFDUyxNQUFNO2dCQUNULE9BQU9aLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQWlCO1lBQ3hEO1lBRUEscURBQXFEO1lBQ3JELElBQUlLLEtBQUtJLFFBQVEsSUFBSUosS0FBS0ksUUFBUSxDQUFDQyxNQUFNLEdBQUcsR0FBRztnQkFDN0MsSUFBSTtvQkFDRkMsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0NBQXdDLEVBQUVsQixHQUFHLGVBQWUsQ0FBQyxFQUFFVyxLQUFLSSxRQUFRO29CQUV6Riw4QkFBOEI7b0JBQzlCLE1BQU1JLGNBQWMsTUFBTVYsR0FBR1csZUFBZSxHQUFHQyxPQUFPO29CQUN0RCxNQUFNQyxrQkFBa0JILFlBQVlJLEdBQUcsQ0FBQ0MsQ0FBQUEsSUFBS0EsRUFBRUMsSUFBSTtvQkFDbkRSLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDRCQUE0QixDQUFDLEVBQUVJO29CQUU1Qyx3Q0FBd0M7b0JBQ3hDLElBQUlJLG9CQUFvQjtvQkFDeEIsSUFBSSxDQUFDSixnQkFBZ0JLLFFBQVEsQ0FBQyxTQUFTO3dCQUNyQyxNQUFNQyxpQkFBaUJOLGdCQUFnQk8sTUFBTSxDQUFDSixDQUFBQSxPQUM1Q0EsS0FBS0ssV0FBVyxHQUFHSCxRQUFRLENBQUMsVUFBVUYsU0FBUzt3QkFFakQsSUFBSUcsZUFBZVosTUFBTSxHQUFHLEdBQUc7NEJBQzdCVSxvQkFBb0JFLGNBQWMsQ0FBQyxFQUFFOzRCQUNyQ1gsUUFBUUMsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFUSxrQkFBa0IsOEJBQThCLENBQUM7d0JBQy9FO29CQUNGO29CQUVBLHFFQUFxRTtvQkFDckUsTUFBTUssYUFBYXBCLEtBQUtJLFFBQVE7b0JBQ2hDRSxRQUFRQyxHQUFHLENBQUMsQ0FBQyxtQ0FBbUMsQ0FBQyxFQUFFYTtvQkFFbkQsaUVBQWlFO29CQUNqRSxNQUFNaEIsV0FBVyxNQUFNTixHQUFHRyxVQUFVLENBQUNjLG1CQUFtQk0sSUFBSSxDQUFDO3dCQUMzRGxCLEtBQUs7NEJBQUVtQixLQUFLRjt3QkFBVztvQkFDekIsR0FBR1YsT0FBTztvQkFFVkosUUFBUUMsR0FBRyxDQUFDLENBQUMsWUFBWSxFQUFFSCxTQUFTQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQ3BERCxTQUFTUSxHQUFHLENBQUNXLENBQUFBLE1BQVE7NEJBQUVsQyxJQUFJa0MsSUFBSXBCLEdBQUc7NEJBQUVXLE1BQU1TLElBQUlULElBQUk7d0JBQUM7b0JBR3JELHNDQUFzQztvQkFDdENkLEtBQUt3QixlQUFlLEdBQUdwQjtvQkFFdkIsdURBQXVEO29CQUN2RCxJQUFJQSxTQUFTQyxNQUFNLEtBQUssR0FBRzt3QkFDekJDLFFBQVFtQixJQUFJLENBQUMsQ0FBQywyQ0FBMkMsQ0FBQyxFQUFFekIsS0FBS0ksUUFBUTtvQkFDM0UsT0FBTyxJQUFJQSxTQUFTQyxNQUFNLEdBQUdMLEtBQUtJLFFBQVEsQ0FBQ0MsTUFBTSxFQUFFO3dCQUNqREMsUUFBUW1CLElBQUksQ0FBQyxDQUFDLGlCQUFpQixFQUFFckIsU0FBU0MsTUFBTSxDQUFDLGlCQUFpQixFQUFFTCxLQUFLSSxRQUFRLENBQUNDLE1BQU0sQ0FBQyxVQUFVLENBQUM7d0JBRXBHLHVDQUF1Qzt3QkFDdkMsTUFBTXFCLFdBQVd0QixTQUFTUSxHQUFHLENBQUNlLENBQUFBLElBQUtBLEVBQUV4QixHQUFHLENBQUN5QixRQUFRO3dCQUNqRCxNQUFNQyxhQUFhN0IsS0FBS0ksUUFBUSxDQUFDYyxNQUFNLENBQUM3QixDQUFBQSxLQUFNLENBQUNxQyxTQUFTVixRQUFRLENBQUMzQixHQUFHdUMsUUFBUTt3QkFDNUV0QixRQUFRbUIsSUFBSSxDQUFDLENBQUMsMEJBQTBCLENBQUMsRUFBRUk7b0JBQzdDO2dCQUNGLEVBQUUsT0FBT2xDLE9BQU87b0JBQ2RXLFFBQVFtQixJQUFJLENBQUMsMENBQTBDOUIsTUFBTW1DLE9BQU87b0JBQ3BFeEIsUUFBUVgsS0FBSyxDQUFDQTtvQkFDZCx3REFBd0Q7b0JBQ3hESyxLQUFLd0IsZUFBZSxHQUFHLEVBQUU7Z0JBQzNCO1lBQ0YsT0FBTztnQkFDTGxCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRWxCLEdBQUcscUNBQXFDLENBQUM7Z0JBQ25FVyxLQUFLd0IsZUFBZSxHQUFHLEVBQUU7WUFDM0I7WUFFQSxPQUFPcEMsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRU07WUFBSztRQUNyQyxFQUFFLE9BQU9MLE9BQU87WUFDZFcsUUFBUVgsS0FBSyxDQUFDLHdCQUF3QkE7WUFDdEMsT0FBT1AsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBT0EsTUFBTW1DLE9BQU87WUFBQztRQUNyRDtJQUNGLE9BQU8sSUFBSTNDLElBQUlTLE1BQU0sS0FBSyxPQUFPO1FBQy9CLElBQUk7WUFDRixNQUFNLEVBQUVtQyxTQUFTLEVBQUVDLFVBQVUsRUFBRUMsV0FBVyxFQUFFQyxJQUFJLEVBQUU5QixRQUFRLEVBQUUrQixPQUFPLEVBQUUsR0FBR2hELElBQUlpRCxJQUFJO1lBRWhGLG9DQUFvQztZQUNwQyxJQUFJLENBQUNELFNBQVM7Z0JBQ1osT0FBTy9DLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQWtDO1lBQ3pFO1lBRUEsTUFBTUUsbUJBQW1CLE1BQU1iLDREQUFXQTtZQUMxQyxNQUFNYyxLQUFLRCxpQkFBaUJFLFVBQVUsQ0FBQ0QsRUFBRTtZQUV6QyxzREFBc0Q7WUFDdEQsTUFBTUUsT0FBTyxNQUFNRixHQUFHRyxVQUFVLENBQUMsU0FBU0MsT0FBTyxDQUFDO2dCQUFFQyxLQUFLWjtZQUFhO1lBQ3RFLElBQUksQ0FBQ1MsTUFBTTtnQkFDVCxPQUFPWixJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFQyxPQUFPO2dCQUFpQjtZQUN4RDtZQUVBLGlFQUFpRTtZQUNqRSxJQUFJSyxLQUFLbUMsT0FBTyxDQUFDUCxRQUFRLE9BQU9PLFFBQVFQLFFBQVEsSUFBSTtnQkFDbEQsT0FBT3hDLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQXNDO1lBQzdFO1lBRUEsZ0RBQWdEO1lBQ2hELElBQUkwQyxTQUFTLENBQUM7WUFDZCxJQUFJTixjQUFjTyxXQUFXRCxPQUFPTixTQUFTLEdBQUdBO1lBQ2hELElBQUlDLGVBQWVNLFdBQVdELE9BQU9MLFVBQVUsR0FBR0E7WUFDbEQsSUFBSUMsZ0JBQWdCSyxXQUFXRCxPQUFPSixXQUFXLEdBQUdBO1lBQ3BELElBQUlDLFNBQVNJLFdBQVdELE9BQU9ILElBQUksR0FBR0E7WUFDdEMsSUFBSTlCLGFBQWFrQyxXQUFXRCxPQUFPakMsUUFBUSxHQUFHQTtZQUU5Qyw2QkFBNkI7WUFDN0JpQyxPQUFPRSxZQUFZLEdBQUcsSUFBSUM7WUFFMUIsTUFBTUMsU0FBUyxNQUFNM0MsR0FBR0csVUFBVSxDQUFDLFNBQVN5QyxTQUFTLENBQ25EO2dCQUFFdkMsS0FBS1o7WUFBYSxHQUNwQjtnQkFBRW9ELE1BQU1OO1lBQU87WUFHakIsSUFBSUksT0FBT0csYUFBYSxLQUFLLEdBQUc7Z0JBQzlCLE9BQU94RCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFQyxPQUFPO2dCQUFrQjtZQUN6RDtZQUNBLE9BQU9QLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVvQyxTQUFTO1lBQTRCO1FBQ3JFLEVBQUUsT0FBT25DLE9BQU87WUFDZFcsUUFBUVgsS0FBSyxDQUFDLHdCQUF3QkE7WUFDdEMsT0FBT1AsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFBRUMsT0FBT0EsTUFBTW1DLE9BQU87WUFBQztRQUNyRDtJQUVGLE9BQU8sSUFBSTNDLElBQUlTLE1BQU0sS0FBSyxVQUFVO1FBQ2xDLElBQUk7WUFDRixNQUFNLEVBQUV1QyxPQUFPLEVBQUUsR0FBR2hELElBQUlpRCxJQUFJO1lBQzVCLElBQUksQ0FBQ0QsU0FBUztnQkFDWixPQUFPL0MsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBa0M7WUFDekU7WUFFQSxNQUFNRSxtQkFBbUIsTUFBTWIsNERBQVdBO1lBQzFDLE1BQU1jLEtBQUtELGlCQUFpQkUsVUFBVSxDQUFDRCxFQUFFO1lBRXpDLDJEQUEyRDtZQUMzRCxNQUFNRSxPQUFPLE1BQU1GLEdBQUdHLFVBQVUsQ0FBQyxTQUFTQyxPQUFPLENBQUM7Z0JBQUVDLEtBQUtaO1lBQWE7WUFDdEUsSUFBSSxDQUFDUyxNQUFNO2dCQUNULE9BQU9aLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQUVDLE9BQU87Z0JBQWlCO1lBQ3hEO1lBRUEscUNBQXFDO1lBQ3JDLElBQUlLLEtBQUttQyxPQUFPLENBQUNQLFFBQVEsT0FBT08sUUFBUVAsUUFBUSxJQUFJO2dCQUNsRCxPQUFPeEMsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsT0FBTztnQkFBc0M7WUFDN0U7WUFFQSxrQkFBa0I7WUFDbEIsTUFBTThDLFNBQVMsTUFBTTNDLEdBQUdHLFVBQVUsQ0FBQyxTQUFTNEMsU0FBUyxDQUFDO2dCQUFFMUMsS0FBS1o7WUFBYTtZQUUxRSxJQUFJa0QsT0FBT0ssWUFBWSxLQUFLLEdBQUc7Z0JBQzdCLE9BQU8xRCxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFQyxPQUFPO2dCQUEyQjtZQUNsRTtZQUVBLCtDQUErQztZQUMvQyxJQUFJO2dCQUNGLE1BQU1HLEdBQUdHLFVBQVUsQ0FBQyxjQUFjOEMsVUFBVSxDQUFDO29CQUFFQyxTQUFTekQ7Z0JBQWE7WUFDdkUsRUFBRSxPQUFPSSxPQUFPO2dCQUNkVyxRQUFRbUIsSUFBSSxDQUFDLGtDQUFrQzlCLE1BQU1tQyxPQUFPO1lBQzVELG9EQUFvRDtZQUN0RDtZQUVBLE9BQU8xQyxJQUFJSyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFb0MsU0FBUztZQUE0QjtRQUNyRSxFQUFFLE9BQU9uQyxPQUFPO1lBQ2RXLFFBQVFYLEtBQUssQ0FBQyx3QkFBd0JBO1lBQ3RDLE9BQU9QLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVDLE9BQU9BLE1BQU1tQyxPQUFPO1lBQUM7UUFDckQ7SUFDRixPQUFPO1FBQ0wxQyxJQUFJNkQsU0FBUyxDQUFDLFNBQVM7WUFBQztZQUFPO1lBQU87U0FBUztRQUMvQyxPQUFPN0QsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPLENBQUMsT0FBTyxFQUFFUixJQUFJUyxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQUM7SUFDMUU7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL2tvYmJ5L0Rlc2t0b3AvY3M0MzAvQXJ0aXZpc20vc3JjL3BhZ2VzL2FwaS90b3VyL1tpZF0uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gZWRpdCBhbmQgZGVsZXRlIHRvdXIgYnkgaWRcbi8vIFJlcXVpcmVkIGZpZWxkczogdXNlcl9pZFxuaW1wb3J0IGNvbm5lY3RUb0RCIGZyb20gXCIuLi8uLi8uLi91dGlscy9kYkNvbm5lY3RcIjtcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBjb25zdCB7IGlkIH0gPSByZXEucXVlcnk7XG4gIFxuICAvLyBDb252ZXJ0IGlkIHRvIE9iamVjdElkXG4gIGxldCB0b3VyT2JqZWN0SWQ7XG4gIHRyeSB7XG4gICAgdG91ck9iamVjdElkID0gbmV3IE9iamVjdElkKGlkKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiSW52YWxpZCB0b3VyIElEIGZvcm1hdFwiIH0pO1xuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiR0VUXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbW9uZ29vc2VJbnN0YW5jZSA9IGF3YWl0IGNvbm5lY3RUb0RCKCk7XG4gICAgICBjb25zdCBkYiA9IG1vbmdvb3NlSW5zdGFuY2UuY29ubmVjdGlvbi5kYjtcblxuICAgICAgY29uc3QgdG91ciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJ0b3Vyc1wiKS5maW5kT25lKHsgX2lkOiB0b3VyT2JqZWN0SWQgfSk7XG4gICAgICBcbiAgICAgIGlmICghdG91cikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogXCJUb3VyIG5vdCBmb3VuZFwiIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiB0b3VyIGhhcyBhcnR3b3JrIElEcywgZmV0Y2ggdGhlIGFydHdvcmsgZGV0YWlsc1xuICAgICAgaWYgKHRvdXIuYXJ0d29ya3MgJiYgdG91ci5hcnR3b3Jrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtBUEldIEZldGNoaW5nIGFydHdvcmsgZGV0YWlscyBmb3IgdG91ciAke2lkfSB3aXRoIGFydHdvcmtzOmAsIHRvdXIuYXJ0d29ya3MpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGF2YWlsYWJsZSBjb2xsZWN0aW9uc1xuICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb25zID0gYXdhaXQgZGIubGlzdENvbGxlY3Rpb25zKCkudG9BcnJheSgpO1xuICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lcyA9IGNvbGxlY3Rpb25zLm1hcChjID0+IGMubmFtZSk7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtBUEldIEF2YWlsYWJsZSBjb2xsZWN0aW9uczpgLCBjb2xsZWN0aW9uTmFtZXMpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIERldGVybWluZSB0aGUgY29ycmVjdCBjb2xsZWN0aW9uIG5hbWVcbiAgICAgICAgICBsZXQgYXJ0Q29sbGVjdGlvbk5hbWUgPSBcImFydHNcIjtcbiAgICAgICAgICBpZiAoIWNvbGxlY3Rpb25OYW1lcy5pbmNsdWRlcyhcImFydHNcIikpIHtcbiAgICAgICAgICAgIGNvbnN0IGFydENvbGxlY3Rpb25zID0gY29sbGVjdGlvbk5hbWVzLmZpbHRlcihuYW1lID0+IFxuICAgICAgICAgICAgICBuYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJhcnRcIikgJiYgbmFtZSAhPT0gXCJ0b3Vyc1wiXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKGFydENvbGxlY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgYXJ0Q29sbGVjdGlvbk5hbWUgPSBhcnRDb2xsZWN0aW9uc1swXTtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtBUEldIFVzaW5nIFwiJHthcnRDb2xsZWN0aW9uTmFtZX1cIiBjb2xsZWN0aW9uIGluc3RlYWQgb2YgXCJhcnRzXCJgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRG9uJ3QgY29udmVydCBJRHMgLSB3ZSBrbm93IHRoZXkncmUgc3RyaW5ncyBmcm9tIG91ciBlYXJsaWVyIGNoZWNrXG4gICAgICAgICAgY29uc3QgYXJ0d29ya0lkcyA9IHRvdXIuYXJ0d29ya3M7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtBUEldIFVzaW5nIGFydHdvcmsgSURzIGFzIHN0cmluZ3M6YCwgYXJ0d29ya0lkcyk7XG5cbiAgICAgICAgICAvLyBRdWVyeSBkaXJlY3RseSB3aXRoIHN0cmluZyBJRHMgc2luY2UgdGhhdCdzIGhvdyB0aGV5J3JlIHN0b3JlZFxuICAgICAgICAgIGNvbnN0IGFydHdvcmtzID0gYXdhaXQgZGIuY29sbGVjdGlvbihhcnRDb2xsZWN0aW9uTmFtZSkuZmluZCh7XG4gICAgICAgICAgICBfaWQ6IHsgJGluOiBhcnR3b3JrSWRzIH1cbiAgICAgICAgICB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhgW0FQSV0gRm91bmQgJHthcnR3b3Jrcy5sZW5ndGh9IGFydHdvcmtzOmAsIFxuICAgICAgICAgICAgYXJ0d29ya3MubWFwKGFydCA9PiAoeyBpZDogYXJ0Ll9pZCwgbmFtZTogYXJ0Lm5hbWUgfSkpXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIEFkZCB0aGUgYXJ0d29yayBkZXRhaWxzIHRvIHRoZSB0b3VyXG4gICAgICAgICAgdG91ci5hcnR3b3JrX2RldGFpbHMgPSBhcnR3b3JrcztcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJZiB3ZSBkaWRuJ3QgZmluZCBhbnkgYXJ0d29yayBkZXRhaWxzLCBsb2cgYSB3YXJuaW5nXG4gICAgICAgICAgaWYgKGFydHdvcmtzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQVBJXSBObyBhcnR3b3JrIGRldGFpbHMgZm91bmQgZm9yIHRoZSBJRHM6YCwgdG91ci5hcnR3b3Jrcyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChhcnR3b3Jrcy5sZW5ndGggPCB0b3VyLmFydHdvcmtzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQVBJXSBGb3VuZCBvbmx5ICR7YXJ0d29ya3MubGVuZ3RofSBhcnR3b3JrcyBvdXQgb2YgJHt0b3VyLmFydHdvcmtzLmxlbmd0aH0gcmVxdWVzdGVkYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIExvZyB3aGljaCBhcnR3b3JrIElEcyB3ZXJlIG5vdCBmb3VuZFxuICAgICAgICAgICAgY29uc3QgZm91bmRJZHMgPSBhcnR3b3Jrcy5tYXAoYSA9PiBhLl9pZC50b1N0cmluZygpKTtcbiAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdJZHMgPSB0b3VyLmFydHdvcmtzLmZpbHRlcihpZCA9PiAhZm91bmRJZHMuaW5jbHVkZXMoaWQudG9TdHJpbmcoKSkpO1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBbQVBJXSBNaXNzaW5nIGFydHdvcmsgSURzOmAsIG1pc3NpbmdJZHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXCJbQVBJXSBDb3VsZCBub3QgZmV0Y2ggYXJ0d29yayBkZXRhaWxzOlwiLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAvLyBDb250aW51ZSBldmVuIGlmIGFydHdvcmsgZGV0YWlscyBjb3VsZCBub3QgYmUgZmV0Y2hlZFxuICAgICAgICAgIHRvdXIuYXJ0d29ya19kZXRhaWxzID0gW107XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBbQVBJXSBUb3VyICR7aWR9IGhhcyBubyBhcnR3b3JrcyB0byBmZXRjaCBkZXRhaWxzIGZvcmApO1xuICAgICAgICB0b3VyLmFydHdvcmtfZGV0YWlscyA9IFtdO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB0b3VyIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgdG91cjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHJlcS5tZXRob2QgPT09IFwiUFVUXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB0b3VyX25hbWUsIHZpc2liaWxpdHksIGRlc2NyaXB0aW9uLCBjaXR5LCBhcnR3b3JrcywgdXNlcl9pZCB9ID0gcmVxLmJvZHk7XG4gICAgICBcbiAgICAgIC8vIFJlcXVpcmUgdXNlcl9pZCBmb3IgYXV0aG9yaXphdGlvblxuICAgICAgaWYgKCF1c2VyX2lkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIk1pc3NpbmcgdXNlcl9pZCBpbiByZXF1ZXN0IGJvZHlcIiB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbW9uZ29vc2VJbnN0YW5jZSA9IGF3YWl0IGNvbm5lY3RUb0RCKCk7XG4gICAgICBjb25zdCBkYiA9IG1vbmdvb3NlSW5zdGFuY2UuY29ubmVjdGlvbi5kYjtcblxuICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdXNlciBpcyBhdXRob3JpemVkIHRvIGVkaXQgdGhpcyB0b3VyXG4gICAgICBjb25zdCB0b3VyID0gYXdhaXQgZGIuY29sbGVjdGlvbihcInRvdXJzXCIpLmZpbmRPbmUoeyBfaWQ6IHRvdXJPYmplY3RJZCB9KTtcbiAgICAgIGlmICghdG91cikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogXCJUb3VyIG5vdCBmb3VuZFwiIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDb21wYXJlIHRvdXIncyB1c2VyX2lkIHdpdGggcHJvdmlkZWQgdXNlcl9pZCBmb3IgYXV0aG9yaXphdGlvblxuICAgICAgaWYgKHRvdXIudXNlcl9pZC50b1N0cmluZygpICE9PSB1c2VyX2lkLnRvU3RyaW5nKCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkOiBUaGlzIGlzIG5vdCB5b3VyIHRvdXJcIiB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQnVpbGQgdXBkYXRlIG9iamVjdCB3aXRoIG9ubHkgcHJvdmlkZWQgZmllbGRzXG4gICAgICBsZXQgdXBkYXRlID0ge307XG4gICAgICBpZiAodG91cl9uYW1lICE9PSB1bmRlZmluZWQpIHVwZGF0ZS50b3VyX25hbWUgPSB0b3VyX25hbWU7XG4gICAgICBpZiAodmlzaWJpbGl0eSAhPT0gdW5kZWZpbmVkKSB1cGRhdGUudmlzaWJpbGl0eSA9IHZpc2liaWxpdHk7XG4gICAgICBpZiAoZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICBpZiAoY2l0eSAhPT0gdW5kZWZpbmVkKSB1cGRhdGUuY2l0eSA9IGNpdHk7XG4gICAgICBpZiAoYXJ0d29ya3MgIT09IHVuZGVmaW5lZCkgdXBkYXRlLmFydHdvcmtzID0gYXJ0d29ya3M7XG4gICAgICBcbiAgICAgIC8vIEFkZCBsYXN0X3VwZGF0ZWQgdGltZXN0YW1wXG4gICAgICB1cGRhdGUubGFzdF91cGRhdGVkID0gbmV3IERhdGUoKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbihcInRvdXJzXCIpLnVwZGF0ZU9uZShcbiAgICAgICAgeyBfaWQ6IHRvdXJPYmplY3RJZCB9LFxuICAgICAgICB7ICRzZXQ6IHVwZGF0ZSB9XG4gICAgICApO1xuXG4gICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6IFwiTm8gY2hhbmdlcyBtYWRlXCIgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiBcIlRvdXIgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIiB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIHRvdXI6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgIH1cblxuICB9IGVsc2UgaWYgKHJlcS5tZXRob2QgPT09IFwiREVMRVRFXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB1c2VyX2lkIH0gPSByZXEuYm9keTtcbiAgICAgIGlmICghdXNlcl9pZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJNaXNzaW5nIHVzZXJfaWQgaW4gcmVxdWVzdCBib2R5XCIgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1vbmdvb3NlSW5zdGFuY2UgPSBhd2FpdCBjb25uZWN0VG9EQigpO1xuICAgICAgY29uc3QgZGIgPSBtb25nb29zZUluc3RhbmNlLmNvbm5lY3Rpb24uZGI7XG5cbiAgICAgIC8vIENoZWNrIGlmIHRvdXIgZXhpc3RzIGFuZCBpZiB1c2VyIGlzIGF1dGhvcml6ZWQgdG8gZGVsZXRlXG4gICAgICBjb25zdCB0b3VyID0gYXdhaXQgZGIuY29sbGVjdGlvbihcInRvdXJzXCIpLmZpbmRPbmUoeyBfaWQ6IHRvdXJPYmplY3RJZCB9KTtcbiAgICAgIGlmICghdG91cikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogXCJUb3VyIG5vdCBmb3VuZFwiIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDb21wYXJlIHVzZXJfaWRzIGZvciBhdXRob3JpemF0aW9uXG4gICAgICBpZiAodG91ci51c2VyX2lkLnRvU3RyaW5nKCkgIT09IHVzZXJfaWQudG9TdHJpbmcoKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogXCJVbmF1dGhvcml6ZWQ6IFRoaXMgaXMgbm90IHlvdXIgdG91clwiIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWxldGUgdGhlIHRvdXJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJ0b3Vyc1wiKS5kZWxldGVPbmUoeyBfaWQ6IHRvdXJPYmplY3RJZCB9KTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5kZWxldGVkQ291bnQgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6IFwiVG91ciBjb3VsZG4ndCBiZSBkZWxldGVkXCIgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFsc28gZGVsZXRlIGFueSBzYXZlZCBpbnN0YW5jZXMgb2YgdGhpcyB0b3VyXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKFwic2F2ZWRUb3Vyc1wiKS5kZWxldGVNYW55KHsgdG91cl9pZDogdG91ck9iamVjdElkIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwiRXJyb3IgY2xlYW5pbmcgdXAgc2F2ZWQgdG91cnM6XCIsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAvLyBDb250aW51ZSBldmVuIGlmIHNhdmVkIHRvdXJzIGNvdWxkIG5vdCBiZSBkZWxldGVkXG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6IFwiVG91ciBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgdG91cjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJlcy5zZXRIZWFkZXIoXCJBbGxvd1wiLCBbXCJHRVRcIiwgXCJQVVRcIiwgXCJERUxFVEVcIl0pO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBgTWV0aG9kICR7cmVxLm1ldGhvZH0gTm90IEFsbG93ZWRgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY29ubmVjdFRvREIiLCJPYmplY3RJZCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJpZCIsInF1ZXJ5IiwidG91ck9iamVjdElkIiwiZXJyIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwibWV0aG9kIiwibW9uZ29vc2VJbnN0YW5jZSIsImRiIiwiY29ubmVjdGlvbiIsInRvdXIiLCJjb2xsZWN0aW9uIiwiZmluZE9uZSIsIl9pZCIsImFydHdvcmtzIiwibGVuZ3RoIiwiY29uc29sZSIsImxvZyIsImNvbGxlY3Rpb25zIiwibGlzdENvbGxlY3Rpb25zIiwidG9BcnJheSIsImNvbGxlY3Rpb25OYW1lcyIsIm1hcCIsImMiLCJuYW1lIiwiYXJ0Q29sbGVjdGlvbk5hbWUiLCJpbmNsdWRlcyIsImFydENvbGxlY3Rpb25zIiwiZmlsdGVyIiwidG9Mb3dlckNhc2UiLCJhcnR3b3JrSWRzIiwiZmluZCIsIiRpbiIsImFydCIsImFydHdvcmtfZGV0YWlscyIsIndhcm4iLCJmb3VuZElkcyIsImEiLCJ0b1N0cmluZyIsIm1pc3NpbmdJZHMiLCJtZXNzYWdlIiwidG91cl9uYW1lIiwidmlzaWJpbGl0eSIsImRlc2NyaXB0aW9uIiwiY2l0eSIsInVzZXJfaWQiLCJib2R5IiwidXBkYXRlIiwidW5kZWZpbmVkIiwibGFzdF91cGRhdGVkIiwiRGF0ZSIsInJlc3VsdCIsInVwZGF0ZU9uZSIsIiRzZXQiLCJtb2RpZmllZENvdW50IiwiZGVsZXRlT25lIiwiZGVsZXRlZENvdW50IiwiZGVsZXRlTWFueSIsInRvdXJfaWQiLCJzZXRIZWFkZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./src/pages/api/tour/[id].js\n");

/***/ }),

/***/ "(api-node)/./src/utils/dbConnect.js":
/*!********************************!*\
  !*** ./src/utils/dbConnect.js ***!
  \********************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! dotenv */ \"dotenv\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var url__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! url */ \"url\");\n/**\n * Database connection utility\n * \n * This module provides a cached connection to the MongoDB database.\n * It ensures that only one connection is created per Node.js instance.\n */ \n\n\n\n\n// Load environment variables\ndotenv__WEBPACK_IMPORTED_MODULE_1__.config({\n    path: path__WEBPACK_IMPORTED_MODULE_2__.join((0,path__WEBPACK_IMPORTED_MODULE_2__.dirname)((0,url__WEBPACK_IMPORTED_MODULE_3__.fileURLToPath)(\"file:///Users/kobby/Desktop/cs430/Artivism/src/utils/dbConnect.js\")), \"..\", \"..\", \".env\")\n});\n// Get MongoDB URI from environment variables\nconst mongoUri = process.env.MONGO_URI;\nconst dbName = process.env.MONGODB_DB_NAME || 'artivism';\nif (!mongoUri) {\n    throw new Error(\"Please define the MONGO_URI environment variable inside .env\");\n}\n// Use global MongoDB cached connection\nlet cachedMongoObject = global.mongoose;\nif (!cachedMongoObject) {\n    cachedMongoObject = global.mongoose = {\n        connection: null,\n        promise: null\n    };\n}\n/**\n * Connect to MongoDB with connection pooling\n * @returns {Promise<mongoose>} Mongoose connection\n */ async function connectToDB() {\n    if (cachedMongoObject.connection) {\n        return cachedMongoObject.connection;\n    }\n    if (!cachedMongoObject.promise) {\n        const opts = {\n            bufferCommands: false,\n            dbName: dbName\n        };\n        try {\n            cachedMongoObject.promise = mongoose__WEBPACK_IMPORTED_MODULE_0__.connect(mongoUri, opts).then((mongoose)=>{\n                return mongoose;\n            });\n            cachedMongoObject.connection = await cachedMongoObject.promise;\n            return cachedMongoObject.connection;\n        } catch (error) {\n            throw new Error(`Database connection failed: ${error.message}`);\n        }\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (connectToDB);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3NyYy91dGlscy9kYkNvbm5lY3QuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7Ozs7Q0FLQyxHQUUrQjtBQUNKO0FBQ0o7QUFDTztBQUNLO0FBRXBDLDZCQUE2QjtBQUM3QkMsMENBQWEsQ0FBQztJQUNaQyxNQUFNQSxzQ0FBUyxDQUFDQyw2Q0FBT0EsQ0FBQ0Msa0RBQWFBLENBQUMsbUVBQWUsSUFBSSxNQUFNLE1BQU07QUFDdkU7QUFFQSw2Q0FBNkM7QUFDN0MsTUFBTUksV0FBV0MsUUFBUUMsR0FBRyxDQUFDQyxTQUFTO0FBQ3RDLE1BQU1DLFNBQVNILFFBQVFDLEdBQUcsQ0FBQ0csZUFBZSxJQUFJO0FBRTlDLElBQUksQ0FBQ0wsVUFBVTtJQUNiLE1BQU0sSUFBSU0sTUFDUjtBQUVKO0FBRUEsdUNBQXVDO0FBQ3ZDLElBQUlDLG9CQUFvQkMsT0FBT2hCLFFBQVE7QUFDdkMsSUFBSSxDQUFDZSxtQkFBbUI7SUFDdEJBLG9CQUFvQkMsT0FBT2hCLFFBQVEsR0FBRztRQUFFaUIsWUFBWTtRQUFNQyxTQUFTO0lBQUs7QUFDMUU7QUFFQTs7O0NBR0MsR0FDRCxlQUFlQztJQUNiLElBQUlKLGtCQUFrQkUsVUFBVSxFQUFFO1FBQ2hDLE9BQU9GLGtCQUFrQkUsVUFBVTtJQUNyQztJQUVBLElBQUksQ0FBQ0Ysa0JBQWtCRyxPQUFPLEVBQUU7UUFDOUIsTUFBTUUsT0FBTztZQUNYQyxnQkFBZ0I7WUFDaEJULFFBQVFBO1FBQ1Y7UUFDQSxJQUFJO1lBQ0ZHLGtCQUFrQkcsT0FBTyxHQUFHbEIsNkNBQ2xCLENBQUNRLFVBQVVZLE1BQ2xCRyxJQUFJLENBQUMsQ0FBQ3ZCO2dCQUNMLE9BQU9BO1lBQ1Q7WUFDRmUsa0JBQWtCRSxVQUFVLEdBQUcsTUFBTUYsa0JBQWtCRyxPQUFPO1lBQzlELE9BQU9ILGtCQUFrQkUsVUFBVTtRQUNyQyxFQUFFLE9BQU9PLE9BQU87WUFDZCxNQUFNLElBQUlWLE1BQU0sQ0FBQyw0QkFBNEIsRUFBRVUsTUFBTUMsT0FBTyxFQUFFO1FBQ2hFO0lBQ0Y7QUFDRjtBQUVBLGlFQUFlTixXQUFXQSxFQUFDIiwic291cmNlcyI6WyIvVXNlcnMva29iYnkvRGVza3RvcC9jczQzMC9BcnRpdmlzbS9zcmMvdXRpbHMvZGJDb25uZWN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGF0YWJhc2UgY29ubmVjdGlvbiB1dGlsaXR5XG4gKiBcbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIGEgY2FjaGVkIGNvbm5lY3Rpb24gdG8gdGhlIE1vbmdvREIgZGF0YWJhc2UuXG4gKiBJdCBlbnN1cmVzIHRoYXQgb25seSBvbmUgY29ubmVjdGlvbiBpcyBjcmVhdGVkIHBlciBOb2RlLmpzIGluc3RhbmNlLlxuICovXG5cbmltcG9ydCBtb25nb29zZSBmcm9tIFwibW9uZ29vc2VcIjtcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IGRpcm5hbWUgfSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgZmlsZVVSTFRvUGF0aCB9IGZyb20gXCJ1cmxcIjtcblxuLy8gTG9hZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbmRvdGVudi5jb25maWcoe1xuICBwYXRoOiBwYXRoLmpvaW4oZGlybmFtZShmaWxlVVJMVG9QYXRoKGltcG9ydC5tZXRhLnVybCkpLCBcIi4uXCIsIFwiLi5cIiwgXCIuZW52XCIpLFxufSk7XG5cbi8vIEdldCBNb25nb0RCIFVSSSBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlc1xuY29uc3QgbW9uZ29VcmkgPSBwcm9jZXNzLmVudi5NT05HT19VUkk7XG5jb25zdCBkYk5hbWUgPSBwcm9jZXNzLmVudi5NT05HT0RCX0RCX05BTUUgfHwgJ2FydGl2aXNtJztcblxuaWYgKCFtb25nb1VyaSkge1xuICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgXCJQbGVhc2UgZGVmaW5lIHRoZSBNT05HT19VUkkgZW52aXJvbm1lbnQgdmFyaWFibGUgaW5zaWRlIC5lbnZcIlxuICApO1xufVxuXG4vLyBVc2UgZ2xvYmFsIE1vbmdvREIgY2FjaGVkIGNvbm5lY3Rpb25cbmxldCBjYWNoZWRNb25nb09iamVjdCA9IGdsb2JhbC5tb25nb29zZTtcbmlmICghY2FjaGVkTW9uZ29PYmplY3QpIHtcbiAgY2FjaGVkTW9uZ29PYmplY3QgPSBnbG9iYWwubW9uZ29vc2UgPSB7IGNvbm5lY3Rpb246IG51bGwsIHByb21pc2U6IG51bGwgfTtcbn1cblxuLyoqXG4gKiBDb25uZWN0IHRvIE1vbmdvREIgd2l0aCBjb25uZWN0aW9uIHBvb2xpbmdcbiAqIEByZXR1cm5zIHtQcm9taXNlPG1vbmdvb3NlPn0gTW9uZ29vc2UgY29ubmVjdGlvblxuICovXG5hc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EQigpIHtcbiAgaWYgKGNhY2hlZE1vbmdvT2JqZWN0LmNvbm5lY3Rpb24pIHtcbiAgICByZXR1cm4gY2FjaGVkTW9uZ29PYmplY3QuY29ubmVjdGlvbjtcbiAgfVxuXG4gIGlmICghY2FjaGVkTW9uZ29PYmplY3QucHJvbWlzZSkge1xuICAgIGNvbnN0IG9wdHMgPSB7IFxuICAgICAgYnVmZmVyQ29tbWFuZHM6IGZhbHNlLFxuICAgICAgZGJOYW1lOiBkYk5hbWVcbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICBjYWNoZWRNb25nb09iamVjdC5wcm9taXNlID0gbW9uZ29vc2VcbiAgICAgICAgLmNvbm5lY3QobW9uZ29VcmksIG9wdHMpXG4gICAgICAgIC50aGVuKChtb25nb29zZSkgPT4ge1xuICAgICAgICAgIHJldHVybiBtb25nb29zZTtcbiAgICAgICAgfSk7XG4gICAgICBjYWNoZWRNb25nb09iamVjdC5jb25uZWN0aW9uID0gYXdhaXQgY2FjaGVkTW9uZ29PYmplY3QucHJvbWlzZTtcbiAgICAgIHJldHVybiBjYWNoZWRNb25nb09iamVjdC5jb25uZWN0aW9uO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYERhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3RUb0RCO1xuIl0sIm5hbWVzIjpbIm1vbmdvb3NlIiwiZG90ZW52IiwicGF0aCIsImRpcm5hbWUiLCJmaWxlVVJMVG9QYXRoIiwiY29uZmlnIiwiam9pbiIsInVybCIsIm1vbmdvVXJpIiwicHJvY2VzcyIsImVudiIsIk1PTkdPX1VSSSIsImRiTmFtZSIsIk1PTkdPREJfREJfTkFNRSIsIkVycm9yIiwiY2FjaGVkTW9uZ29PYmplY3QiLCJnbG9iYWwiLCJjb25uZWN0aW9uIiwicHJvbWlzZSIsImNvbm5lY3RUb0RCIiwib3B0cyIsImJ1ZmZlckNvbW1hbmRzIiwiY29ubmVjdCIsInRoZW4iLCJlcnJvciIsIm1lc3NhZ2UiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./src/utils/dbConnect.js\n");

/***/ }),

/***/ "dotenv":
/*!*************************!*\
  !*** external "dotenv" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("dotenv");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftour%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Ftour%2F%5Bid%5D.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();